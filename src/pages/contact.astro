---
import BaseLayout from '../layouts/BaseLayout.astro';
import Section from '../components/ui/Section.astro';
import Button from '../components/ui/Button.astro';
import { getCollection, getEntry } from 'astro:content';

const siteSettings = await getCollection('siteSettings');
const site = siteSettings[0];

if (!site) {
  throw new Error('Missing siteSettings entry. Add src/content/siteSettings/practice.json.');
}

const contactPage = await getEntry('pages', 'contact');

if (!contactPage) {
  throw new Error('Missing contact page content in src/content/pages/contact.md.');
}

const { data: page } = contactPage;
const settings = site.data;
const phoneHref = `tel:${settings.phone.replace(/[^0-9+]/g, '')}`;
const fullAddress = [settings.addressLine1, settings.addressLine2].filter(Boolean).join(', ');
---

<BaseLayout title={page.title ?? 'Contact'} description={page.intro}>
  <main class="bg-surface-soft">
    <Section>
      <div class="space-y-4">
        <p class="text-xs font-semibold uppercase tracking-[0.16em] text-brand-500">Contact</p>
        <h1 class="text-3xl font-semibold text-ink-900 md:text-4xl">{page.title}</h1>
        {page.intro && <p class="max-w-2xl text-base text-ink-600">{page.intro}</p>}
      </div>

      <div class="mt-10 grid gap-10 md:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)] md:items-start">
        <div class="space-y-6 text-sm leading-relaxed text-ink-700">
          <div>
            <h2 class="text-sm font-semibold uppercase tracking-wide text-ink-600">Phone</h2>
            <p class="mt-1">
              <a href={phoneHref} class="text-brand-600 hover:text-brand-700">
                {settings.phone}
              </a>
            </p>
          </div>

          <div>
            <h2 class="text-sm font-semibold uppercase tracking-wide text-ink-600">Email</h2>
            {settings.email && (
              <p class="mt-1">
                <a href={`mailto:${settings.email}`} class="text-brand-600 hover:text-brand-700">
                  {settings.email}
                </a>
              </p>
            )}
          </div>

          <div>
            <h2 class="text-sm font-semibold uppercase tracking-wide text-ink-600">Address</h2>
            <p class="mt-1 whitespace-pre-line">
              {fullAddress}
              <br />
              {settings.city}, {settings.state}
            </p>
          </div>

          {Array.isArray(settings.hours) && settings.hours.length > 0 && (
            <div>
              <h2 class="text-sm font-semibold uppercase tracking-wide text-ink-600">Hours</h2>
              <dl class="mt-2 space-y-1">
                {settings.hours.map((row) => (
                  <div class="flex justify-between gap-4" data-key={row.label}>
                    <dt class="text-ink-500">{row.label}</dt>
                    <dd class="text-ink-900">{row.value}</dd>
                  </div>
                ))}
              </dl>
            </div>
          )}

          <div class="flex flex-wrap gap-3 pt-2">
            <a
              href={phoneHref}
              class="inline-flex items-center justify-center rounded-full bg-brand-500 px-5 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-brand-600"
            >
              Call us
            </a>
            {settings.googleMapsUrl && (
              <a
                href={settings.googleMapsUrl}
                class="inline-flex items-center justify-center rounded-full border border-surface-border bg-white px-5 py-2.5 text-sm font-medium text-ink-900 shadow-sm hover:bg-surface-soft"
              >
                Get directions
              </a>
            )}
          </div>
        </div>

        <aside class="rounded-3xl bg-white shadow-card-soft ring-1 ring-surface-border/50 overflow-hidden min-h-[260px]">
          {settings.googleMapsUrl ? (
            <iframe
              src={settings.googleMapsUrl}
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              class="h-full w-full min-h-[260px]"
              title={`Map to ${settings.practiceName}`}
            />
          ) : (
            <div class="flex h-full min-h-[260px] items-center justify-center px-6 py-8 text-center text-sm text-ink-500">
              Map coming soon â€” add a Google Maps URL in Site Settings.
            </div>
          )}
        </aside>
      </div>
    </Section>
  </main>
</BaseLayout>
